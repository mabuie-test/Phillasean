<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Portal do Cliente</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <h1>Portal do Cliente</h1>
    <nav><a href="index.html">← Voltar</a></nav>
    <table id="orders-table">
      <thead><tr><th>Serviço</th><th>Data</th><th>Status</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>
  <script>
    const API_BASE = 'https://phillaseanbackend.onrender.com';
    async function apiFetch(path, opts={}) {
      const token = localStorage.getItem('token');
      const h = {'Content-Type':'application/json', ...opts.headers};
      if(token) h.Authorization='Bearer '+token;
      const r = await fetch(API_BASE+'/api'+path, {...opts,headers:h});
      if(!r.ok) throw new Error(await r.text());
      return r.json();
    }
    function getUserId(){ return new URLSearchParams(location.search).get('userId'); }
    async function loadOrders(){
      try{
        const uid = getUserId();
        const ord=await apiFetch(`/orders?userId=${uid}`);
        const tb=document.querySelector('#orders-table tbody');
        ord.forEach(o=>{
          const tr=document.createElement('tr');
          tr.innerHTML=`<td>${o.service}</td>
                        <td>${new Date(o.createdAt).toLocaleString()}</td>
                        <td>${o.status}</td>`;
          tb.appendChild(tr);
        });
      }catch(e){ alert(e.message); }
    }
    loadOrders();
  </script>
</body>
</html>
